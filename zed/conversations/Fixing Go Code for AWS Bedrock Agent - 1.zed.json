{"id":"8b456e81-b2bb-4916-9b17-6be7c72b1231","zed":"context","version":"0.4.0","text":"\n\n\n```go apigo/Services/LLMService/LLMService.go\npackage LLMService\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"os\"\n\n\t\"github.com/aws/aws-sdk-go-v2/config\"\n\t\"github.com/aws/aws-sdk-go-v2/service/bedrockagentruntime\"\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/google/uuid\"\n)\n\ntype ClaudeRequest struct {\n\tPrompt            string   `json:\"prompt\"`\n\tMaxTokensToSample int      `json:\"max_tokens_to_sample\"`\n\tTemperature       float64  `json:\"temperature,omitempty\"`\n\tStopSequences     []string `json:\"stop_sequences,omitempty\"`\n}\n\ntype ClaudeResponse struct {\n\tCompletion string `json:\"completion\"`\n}\n\nvar client *bedrockagentruntime.Client\nvar cfg aws.Config\n\nfunc Setup() {\n\tcfg, err := config.LoadDefaultConfig(\n\t\tcontext.Background(),\n\t)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tclient = bedrockagentruntime.NewFromConfig(cfg)\n\n}\n\nfunc Ask(ticker string, ctx context.Context) (string, error) {\n\tagentId := os.Getenv(\"AGENT_ID\")\n\tsessionId := uuid.New().String()\n\tresponse, err := client.InvokeAgent(ctx, &bedrockagentruntime.InvokeAgentInput{\n\t\tAgentId:      aws.String(agentId),\n\t\tInputText:    aws.String(ticker),\n\t\tAgentAliasId: aws.String(\"GZIBIQPVC3\"),\n\t\tEnableTrace:  aws.Bool(false),\n\t\tSessionId:    aws.String(sessionId),\n\t})\n\tif err != nil {\n\t\tfmt.Printf(\"failed to invoke: %s\\n\", err)\n\t\treturn \"\", err\n\t}\n\tfor event := range response.GetStream().Reader.Events() {\n\t\t\n\t}\n\n\treturn response.Completion, nil\n}\n```\n```go\n\t\treturn \"\", err\n\t}\n\tfor event := range response.GetStream().Reader.Events() {\n// error: event declared and not used\n\t\t\n\t}\n```\n```go\n\t}\n\n\treturn response.Completion, nil\n// error: response.Completion undefined (type *bedrockagentruntime.InvokeAgentOutput has no field or method Completion)\n}\n```\n```go\n\t\treturn \"\", err\n\t}\n\tfor event := range response.GetStream().Reader.Events() {\n// error: event declared and not used\n\t\t\n\t}\n```\n```go\n\t}\n\n\treturn response.Completion, nil\n// error: response.Completion undefined (type *bedrockagentruntime.InvokeAgentOutput has no field or method Completion)\n}\n```\n\nhow to get the string returned \nTo get the string returned from the `InvokeAgent` method in the AWS SDK for Go, you need to correctly handle the streaming response. The `InvokeAgent` method returns a stream of events, and you need to read these events to get the completion text.\n\nHere's how you can modify your code to correctly handle the streaming response and extract the completion text:\n\n1. **Handle the streaming response**: Read the events from the stream and extract the completion text.\n2. **Return the completion text**: Collect the completion text from the events and return it.\n\nHere's the updated code:\n\n```go\npackage LLMService\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"os\"\n\n\t\"github.com/aws/aws-sdk-go-v2/config\"\n\t\"github.com/aws/aws-sdk-go-v2/service/bedrockagentruntime\"\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/google/uuid\"\n)\n\ntype ClaudeRequest struct {\n\tPrompt            string   `json:\"prompt\"`\n\tMaxTokensToSample int      `json:\"max_tokens_to_sample\"`\n\tTemperature       float64  `json:\"temperature,omitempty\"`\n\tStopSequences     []string `json:\"stop_sequences,omitempty\"`\n}\n\ntype ClaudeResponse struct {\n\tCompletion string `json:\"completion\"`\n}\n\nvar client *bedrockagentruntime.Client\nvar cfg aws.Config\n\nfunc Setup() {\n\tvar err error\n\tcfg, err = config.LoadDefaultConfig(\n\t\tcontext.Background(),\n\t)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tclient = bedrockagentruntime.NewFromConfig(cfg)\n}\n\nfunc Ask(ticker string, ctx context.Context) (string, error) {\n\tagentId := os.Getenv(\"AGENT_ID\")\n\tsessionId := uuid.New().String()\n\tresponse, err := client.InvokeAgent(ctx, &bedrockagentruntime.InvokeAgentInput{\n\t\tAgentId:      aws.String(agentId),\n\t\tInputText:    aws.String(ticker),\n\t\tAgentAliasId: aws.String(\"GZIBIQPVC3\"),\n\t\tEnableTrace:  aws.Bool(false),\n\t\tSessionId:    aws.String(sessionId),\n\t})\n\tif err != nil {\n\t\tfmt.Printf(\"failed to invoke: %s\\n\", err)\n\t\treturn \"\", err\n\t}\n\n\tvar completionText string\n\tfor event := range response.GetStream().Reader.Events() {\n\t\tswitch e := event.(type) {\n\t\tcase *bedrockagentruntime.InvokeAgentOutput:\n\t\t\tcompletionText += *e.Completion\n\t\tdefault:\n\t\t\tfmt.Printf(\"unexpected event type: %T\\n\", e)\n\t\t}\n\t}\n\n\treturn completionText, nil\n}\n```\n\n### Explanation:\n1. **Setup Function**: Correctly initializes the AWS SDK configuration and client.\n2. **Ask Function**:\n   - Invokes the agent using the `InvokeAgent` method.\n   - Reads the events from the response stream.\n   - Extracts the completion text from the events and concatenates it.\n   - Returns the concatenated completion text.\n\nThis should correctly handle the streaming response and return the completion text from the agent.\n","messages":[{"id":{"replica_id":0,"value":0},"start":0,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":31}}},{"id":{"replica_id":0,"value":13},"start":2052,"metadata":{"role":"assistant","status":"Done","timestamp":{"replica_id":0,"value":32}}},{"id":{"replica_id":0,"value":14},"start":4660,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":33}}}],"summary":"Fixing Go Code for AWS Bedrock Agent","slash_command_output_sections":[{"range":{"start":0,"end":1},"icon":"Library","label":"Default","metadata":null},{"range":{"start":3,"end":1717},"icon":"File","label":"apigo/Services/LLMService/LLMService.go","metadata":{"path":"apigo/Services/LLMService/LLMService.go"}},{"range":{"start":1717,"end":1849},"icon":"XCircle","label":"event declared and not used","metadata":null},{"range":{"start":1850,"end":2018},"icon":"XCircle","label":"response.Completion undefined (type *bedrockagentruntime.InvokeAgentOutput has no field or method Completion)","metadata":null}]}